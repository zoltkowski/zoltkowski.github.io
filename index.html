<!doctype html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#111827">
  <link rel="icon" href="./icon.svg" type="image/svg+xml">
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="stylesheet" href="./styles.css">
  <title>Geometry Sketch (new)</title>
</head>
<body class="theme-dark">
  <div class="app">
    <div class="toolbar toolbar-bare toolbar-top">
      <div class="tool-row">
        <div class="dropdown" id="styleMenuContainer" style="display:none;">
          <button id="styleMenu" class="tool icon-btn icon-btn-ghost" title="Styl zaznaczenia" aria-label="Styl zaznaczenia">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <line x1="5" y1="7" x2="19" y2="7"/>
              <circle cx="13" cy="7" r="1.8" class="icon-fill"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
              <circle cx="10" cy="12" r="1.8" class="icon-fill"/>
              <line x1="5" y1="17" x2="19" y2="17"/>
              <circle cx="16" cy="17" r="1.8" class="icon-fill"/>
            </svg>
          </button>
          <div class="dropdown-menu" style="width:100%; box-sizing:border-box;">
            <div class="tool-row style-line-row" id="styleEdgesRow" style="justify-content:flex-start;">
              <div class="style-group" id="styleVerticesGroup">
                <button class="tool icon-btn" id="viewVerticesOption" title="Wierzchołki">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="7" cy="12" r="3.6" fill="none" stroke="currentColor"/><circle cx="7" cy="12" r="1.6" class="icon-fill"/><circle cx="17" cy="12" r="3.6" fill="none" stroke="currentColor"/><circle cx="17" cy="12" r="1.6" class="icon-fill"/></svg>
                </button>
                <button class="tool icon-btn" id="viewEdgesOption" title="Krawędzie">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="5" y1="12" x2="19" y2="12"/></svg>
                </button>
              </div>
              <div class="style-group" id="styleTickGroup" style="display:none;">
                <button type="button" class="tool icon-btn tick-btn" id="styleTickToggle" title="Znacznik zgodności" aria-label="Znacznik zgodności" aria-pressed="false">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <line x1="4" y1="12" x2="20" y2="12" />
                    <line x1="12" y1="8" x2="12" y2="16" />
                  </svg>
                </button>
              </div>
              <div class="style-group" id="styleRayGroup">
                <button class="tool icon-btn" id="rayLeftOption" title="Lewa półprosta">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <line x1="4" y1="12" x2="18" y2="12"/>
                    <circle cx="18" cy="12" r="1.7" class="icon-fill"/>
                  </svg>
                </button>
                <button class="tool icon-btn" id="rayRightOption" title="Prawa półprosta">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <circle cx="6" cy="12" r="1.7" class="icon-fill"/>
                    <line x1="6" y1="12" x2="20" y2="12"/>
                  </svg>
                </button>
                <button class="tool icon-btn" id="raySegmentOption" title="Odcinek">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <circle cx="7" cy="12" r="1.8" class="icon-fill"/>
                    <circle cx="17" cy="12" r="1.8" class="icon-fill"/>
                    <line x1="7" y1="12" x2="17" y2="12"/>
                  </svg>
                </button>
              </div>
            </div>
            <input type="color" id="styleColor" value="#15a3ff" style="display:none">
            <div class="tool-row" id="styleColorRow" style="justify-content:flex-start; gap:6px; margin-bottom:4px;">
              <button class="tool icon-btn color-btn" data-slot="0" title="Kolor 1"></button>
              <button class="tool icon-btn color-btn" data-slot="1" title="Kolor 2"></button>
              <button class="tool icon-btn color-btn" data-slot="2" title="Kolor 3"></button>
              <button class="tool icon-btn color-btn" data-slot="3" title="Kolor 4"></button>
              <button class="tool icon-btn color-btn" data-slot="4" title="Kolor 5"></button>
              <button class="tool icon-btn color-btn custom-color-btn" id="customColorBtn" title="Inny kolor">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                  <circle cx="12" cy="12" r="7.5" fill="none" stroke="currentColor"/>
                  <path d="M12 8v8M8 12h8" stroke-width="2" />
                </svg>
              </button>
              <button class="tool icon-btn" id="exteriorAngleBtn" title="Kąt wklęsły" aria-label="Kąt wklęsły" aria-pressed="false" style="display:none;">
                <svg class="icon" viewBox="0 0 100 100" aria-hidden="true">
                  <line x1="50" y1="20" x2="15" y2="80" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
                  <line x1="50" y1="20" x2="85" y2="80" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
                  <path d="M 18 35 A 25 25 0 0 1 82 35" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </button>
            </div>
            <div class="tool-row" id="labelTextRow" style="justify-content:flex-start; display:none;">
              <label for="labelText">Tekst</label>
              <textarea id="labelText" style="flex:1; min-width:120px; height: 2.4em; resize: vertical; font-family: sans-serif;"></textarea>
              <button type="button" id="labelGreekToggle" class="tool icon-btn label-greek-toggle" title="Klawiatura symboli" aria-label="Klawiatura symboli" aria-pressed="false">Aa</button>
            </div>
            <div class="tool-row label-font-row" id="labelFontRow" style="display:none;">
              <button type="button" class="tool icon-btn label-font-btn" id="labelFontDecrease" title="Zmniejsz rozmiar tekstu" aria-label="Zmniejsz rozmiar tekstu">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                  <line x1="6" y1="12" x2="18" y2="12" />
                </svg>
              </button>
              <span id="labelFontSizeValue" class="label-font-size" aria-live="polite">12 px</span>
              <button type="button" class="tool icon-btn label-font-btn" id="labelFontIncrease" title="Zwiększ rozmiar tekstu" aria-label="Zwiększ rozmiar tekstu">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                  <line x1="6" y1="12" x2="18" y2="12" />
                  <line x1="12" y1="6" x2="12" y2="18" />
                </svg>
              </button>
            </div>
            <div class="tool-row label-greek-row" id="labelGreekRow" style="display:none;">
              <button type="button" id="labelGreekShift" class="tool icon-btn label-greek-shift" title="Wielkie litery" aria-label="Wielkie litery" aria-pressed="false">⇧</button>
              <button type="button" id="labelScriptToggle" class="tool icon-btn label-script-toggle" title="Latin script" aria-label="Latin script" aria-pressed="false">A/a</button>
              <!-- Buttons will be generated dynamically -->
            </div>
            <input type="number" id="styleWidth" min="0.1" max="50" step="0.1" value="2" style="display:none">
            <div class="tool-row line-width-row" id="styleWidthRow" style="justify-content:flex-start;">
              <div class="style-group line-width-group">
                <button class="tool icon-btn line-width-btn" id="lineWidthDecrease" title="Zmniejsz grubość" aria-label="Zmniejsz grubość">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <line x1="6" y1="12" x2="18" y2="12" />
                  </svg>
                </button>
                <span id="lineWidthValue" class="line-width-value" aria-live="polite">2 px</span>
                <button class="tool icon-btn line-width-btn" id="lineWidthIncrease" title="Zwiększ grubość" aria-label="Zwiększ grubość">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <line x1="6" y1="12" x2="18" y2="12" />
                    <line x1="12" y1="6" x2="12" y2="18" />
                  </svg>
                </button>
              </div>
              <span class="style-row-gap" id="styleTypeGap"></span>
              <div class="style-group" id="styleTypeInline">
                <button class="tool icon-btn type-btn" data-type="solid" title="Linia ciągła">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/></svg>
                </button>
                <button class="tool icon-btn type-btn" data-type="dashed" title="Linia przerywana">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12" stroke-dasharray="4 3"/></svg>
                </button>
                <button class="tool icon-btn type-btn" data-type="dotted" title="Linia kropkowana">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12" stroke-dasharray="1 3"/></svg>
                </button>
              </div>
            </div>
            <select id="styleType" style="display:none">
              <option value="solid">Ciągła</option>
              <option value="dashed">Przerywana</option>
              <option value="dotted">Kropkowana</option>
            </select>
            <div class="tool-row" id="styleTypeRow" style="justify-content:flex-start; margin-top:6px; display:none;">
              <button class="tool icon-btn type-btn" data-type="solid" title="Linia ciągła">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/></svg>
              </button>
              <button class="tool icon-btn type-btn" data-type="dashed" title="Linia przerywana">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12" stroke-dasharray="4 3"/></svg>
              </button>
              <button class="tool icon-btn type-btn" data-type="dotted" title="Linia kropkowana">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12" stroke-dasharray="1 3"/></svg>
              </button>
            </div>
            <div class="tool-row" id="styleArcRow" style="justify-content:flex-start; margin-top:6px; display:none;">
              <button class="tool icon-btn" id="angleRadiusDecreaseBtn" title="Zmniejsz promień łuku">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                  <line x1="6" y1="12" x2="18" y2="12" />
                </svg>
              </button>
              <button class="tool icon-btn" id="angleRadiusIncreaseBtn" title="Zwiększ promień łuku">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                  <line x1="6" y1="12" x2="18" y2="12" />
                  <line x1="12" y1="6" x2="12" y2="18" />
                </svg>
              </button>
              <button class="tool icon-btn arc-count-btn" data-count="1" title="Pojedynczy łuk">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 16a6 6 0 0 1 12 0"/></svg>
              </button>
              <button class="tool icon-btn arc-count-btn" data-count="2" title="Podwójny łuk">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 17a6 6 0 0 1 12 0"/><path d="M7 13.5a5 5 0 0 1 10 0"/></svg>
              </button>
              <button class="tool icon-btn arc-count-btn" data-count="3" title="Potrójny łuk">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 18a6 6 0 0 1 12 0"/><path d="M6.5 15a5.5 5.5 0 0 1 11 0"/><path d="M7 12a5 5 0 0 1 10 0"/></svg>
              </button>
              <button class="tool icon-btn arc-count-btn" data-count="4" title="Wypełnienie">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 16a6 6 0 0 1 12 0 Z" fill="currentColor" stroke="none"/></svg>
              </button>
              <button class="tool icon-btn" id="rightAngleBtn" title="Kąt prosty">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                  <line x1="6" y1="4" x2="6" y2="20" />
                  <line x1="6" y1="20" x2="20" y2="20" />
                  <rect x="6" y="16" width="4" height="4" fill="none"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <button id="eraserBtn" class="tool icon-btn" title="Gumka" aria-label="Gumka" aria-pressed="false" style="display:none;">
          <svg width="24px" height="24px" viewBox="0 0 256.00098 256.00098" class="icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
            <path fill="none" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" stroke-linecap="round" vector-effect="non-scaling-stroke" d="M216.001,211.833H120.6875l98.14258-98.1416a20.0237,20.0237,0,0,0-.001-28.28418L173.57422,40.15234a20.01987,20.01987,0,0,0-28.2832,0l-56.564,56.564-.00537.00439-.00439.00537-56.564,56.564a20.02163,20.02163,0,0,0,0,28.2832l37.08887,37.08789a4.00051,4.00051,0,0,0,2.82812,1.17188H216.001a4,4,0,0,0,0-8ZM150.94727,45.80859a12.0157,12.0157,0,0,1,16.9707,0l45.25488,45.25489a12.016,12.016,0,0,1,0,16.97168L159.43213,161.7749,97.20654,99.54932ZM109.37305,211.833H73.72754l-35.918-35.916a12.01392,12.01392,0,0,1,0-16.9707l53.74072-53.74072,62.22559,62.22558Z"/>
          </svg>
        </button>
        <button id="hideButton" class="tool icon-btn" title="Ukryj/Pokaż zaznaczone" aria-label="Ukryj/Pokaż zaznaczone" style="display:none;">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12s4-6 9-6 9 6 9 6-4 6-9 6-9-6-9-6Z"/><path d="M4 4 20 20"/></svg>
        </button>
        <button id="copyStyleBtn" class="tool icon-btn" title="Kopiuj/Wklej styl" aria-label="Kopiuj/Wklej styl" aria-pressed="false" style="display:none;">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <g transform="rotate(-45 12 12)">
              <path d="M11 2 c-1 0 -2 1 -2 2 v6 c0 0.6 0.4 1 1 1 h2 c0.6 0 1 -0.4 1 -1 V4 c0 -1 -1 -2 -2 -2" />
              <circle cx="11" cy="4" r="0.9" />
              <rect x="8.5" y="10" width="5" height="2.2" rx="0.4" ry="0.4" />
              <path d="M7.5 12.2 L14.5 12.2 L15.3 16.5 L13.8 15.9 L13.0 17.4 L11.8 16.3 L10.7 17.8 L9.6 16.6 L8.3 17.9 Z" />
              <line x1="9" y1="10.7" x2="12.8" y2="10.7" />
              <line x1="9" y1="11.4" x2="12.8" y2="11.4" />
            </g>
          </svg>
        </button>
        <button id="multiMoveBtn" class="tool icon-btn" title="Przesuń zaznaczone" aria-label="Przesuń zaznaczone" aria-pressed="false" style="display:none;">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3 9.5 5.5 12 8l2.5-2.5L12 3Zm0 13-2.5 2.5L12 21l2.5-2.5L12 16Zm-9-4 2.5 2.5L8 12 5.5 9.5 3 12Zm13 0 2.5 2.5L21 12l-2.5-2.5L16 12Z"/>
          </svg>
        </button>
        <button id="multiCloneBtn" class="tool icon-btn" title="Klonuj zaznaczone" aria-label="Klonuj zaznaczone" style="display:none;">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <rect x="8" y="8" width="13" height="13" rx="2" fill="none" stroke="currentColor"/>
            <path d="M6 16H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v2"/>
          </svg>
        </button>
        <button id="deletePoint" class="tool icon-btn" title="Usuń zaznaczone" aria-label="Usuń zaznaczone" style="display:none;">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 6h14"/><path d="M10 10v8"/><path d="M14 10v8"/><path d="M7 6 8 4h8l1 2"/><path d="M6 6v14h12V6"/></svg>
        </button>
        <div style="flex:1"></div>
        <button id="undo" class="tool icon-btn icon-btn-ghost" title="Cofnij" aria-label="Cofnij">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 8 5 12l5 4"/><path d="M5 12h9a5 5 0 1 1 0 10h-2"/></svg>
        </button>
        <button id="redo" class="tool icon-btn icon-btn-ghost" title="Ponów" aria-label="Ponów">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="m14 8 5 4-5 4"/><path d="M19 12H10a5 5 0 1 0 0 10h2"/></svg>
        </button>
        <div class="dropdown" id="optionsMenuContainer">
          <button id="zoomMenu" class="tool icon-btn icon-btn-ghost" title="Opcje" aria-label="Opcje">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 7h16"/>
              <path d="M4 12h16"/>
              <path d="M4 17h16"/>
            </svg>
          </button>
          <div class="dropdown-menu options-menu">
            <button id="settingsBtn" class="tool icon-btn" title="Konfiguracja" aria-label="Konfiguracja">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.36 6.36-.71-.71M6.35 6.35l-.71-.71m12.72 0-.71.71M6.35 17.65l-.71.71"/>
              </svg>
            </button>
            <button id="showHiddenBtn" class="tool icon-btn" title="Pokaż ukryte" aria-label="Pokaż ukryte"></button>
            <button id="showMeasurementsBtn" class="tool icon-btn" title="Pokaż wymiary" aria-label="Pokaż wymiary" aria-pressed="false">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <line x1="6" y1="18" x2="18" y2="18" stroke="currentColor" stroke-width="1.6"/>
                <line x1="6" y1="16" x2="6" y2="20" stroke="currentColor" stroke-width="1.6"/>
                <line x1="18" y1="16" x2="18" y2="20" stroke="currentColor" stroke-width="1.6"/>
                <text x="12" y="14" font-size="7" text-anchor="middle" fill="currentColor">12</text>
              </svg>
            </button>
            <button id="copyImageBtn" class="tool icon-btn" title="Kopiuj obraz (PNG)" aria-label="Kopiuj obraz">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <rect x="8" y="8" width="11" height="11" rx="2" />
                <rect x="5" y="5" width="11" height="11" rx="2" fill="none" stroke="currentColor" />
              </svg>
            </button>
            <button id="saveImageBtn" class="tool icon-btn" title="Zapisz PNG" aria-label="Zapisz PNG">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="currentColor" />
                <path d="M12 8v8" />
                <path d="m8.5 12.5 3.5 3.5 3.5-3.5" />
              </svg>
            </button>
            <button id="exportJsonBtn" class="tool icon-btn" title="Zapisz (JSON)" aria-label="Zapisz (JSON)">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 3v12"/>
                <path d="m7 11 5 5 5-5"/>
                <path d="M5 19h14"/>
              </svg>
            </button>
            <button id="importJsonBtn" class="tool icon-btn" title="Wczytaj (JSON)" aria-label="Wczytaj (JSON)">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 21V9"/>
                <path d="m7 13 5-5 5 5"/>
                <path d="M5 5h14"/>
              </svg>
            </button>
            <input type="file" id="importJsonInput" accept="application/json" style="display:none">
            <button id="clearAll" class="tool icon-btn" title="Wyczyść wszystko" aria-label="Wyczyść wszystko">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 6h14"/><path d="M10 10v8"/><path d="M14 10v8"/><path d="M7 6 8 4h8l1 2"/><path d="M6 6v14h12V6"/></svg>
            </button>
            <button id="debugToggle" class="tool icon-btn" title="Lista obiektów" aria-label="Debug">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <rect x="4" y="4" width="16" height="16" rx="2" />
                <line x1="8" y1="9" x2="16" y2="9"/>
                <line x1="8" y1="13" x2="16" y2="13"/>
                <line x1="8" y1="17" x2="13" y2="17"/>
              </svg>
            </button>
            <button id="themeDark" class="tool icon-btn" title="Tryb ciemny" aria-pressed="true">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12a9 9 0 1 1-9-9 6 6 0 0 0 9 9Z"/></svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="canvas-wrap">
      <canvas id="canvas"></canvas>
    </div>
    <div id="debugPanel" class="debug-panel" role="dialog" aria-label="Panel debug" aria-modal="false">
      <div id="debugPanelHandle" class="debug-panel__header">
        <span class="debug-panel__title">Lista obiektów</span>
        <button id="debugCloseBtn" class="debug-panel__close" type="button" aria-label="Zamknij panel debug">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6l12 12M18 6 6 18" />
          </svg>
        </button>
      </div>
      <div id="debugContent" class="debug-panel__content"></div>
    </div>
    <div class="toolbar toolbar-bare toolbar-bottom">
      <div class="tool-row tool-row-second" id="toolbarSecondRow" style="justify-content:center; display:none;">
      </div>
      <div class="tool-row" id="toolbarMainRow" style="justify-content:center;">
        <button id="modeMove" class="tool icon-btn" title="Zaznacz" aria-label="Zaznacz">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3 9.5 5.5 12 8l2.5-2.5L12 3Zm0 13-2.5 2.5L12 21l2.5-2.5L12 16Zm-9-4 2.5 2.5L8 12 5.5 9.5 3 12Zm13 0 2.5 2.5L21 12l-2.5-2.5L16 12ZM8 12l8 0" /></svg>
          <span class="sr-only">Zaznacz</span>
        </button>
        <button id="modeMultiselect" class="tool icon-btn" title="Zaznacz wiele" aria-label="Zaznacz wiele">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <rect x="3" y="3" width="8" height="8" rx="1" stroke-dasharray="2 2"/>
            <rect x="13" y="3" width="8" height="8" rx="1" stroke-dasharray="2 2"/>
            <rect x="3" y="13" width="8" height="8" rx="1" stroke-dasharray="2 2"/>
            <rect x="13" y="13" width="8" height="8" rx="1" stroke-dasharray="2 2"/>
          </svg>
          <span class="sr-only">Zaznacz wiele</span>
        </button>
        <button id="modeLabel" class="tool icon-btn" title="Etykieta" aria-label="Etykieta">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 7h9l5 5-5 5H5V7Z"/>
            <path d="M8 11h4" />
            <path d="M8 14h3" />
          </svg>
          <span class="sr-only">Etykieta</span>
        </button>
        <button id="modeAdd" class="tool icon-btn" title="Dodaj punkt" aria-label="Punkt">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="4.5" class="icon-fill"/></svg>
          <span class="sr-only">Punkt</span>
        </button>
        <button id="modeSegment" class="tool icon-btn" title="Odcinek" aria-label="Odcinek">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="6" cy="12" r="2.2" class="icon-fill"/><circle cx="18" cy="12" r="2.2" class="icon-fill"/><line x1="6" y1="12" x2="18" y2="12"/></svg>
          <span class="sr-only">Odcinek</span>
        </button>
        <button id="modeParallel" class="tool icon-btn" title="Równoległa" aria-label="Równoległa">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="5" y1="8" x2="19" y2="8"/><line x1="5" y1="16" x2="19" y2="16"/></svg>
          <span class="sr-only">Równoległa</span>
        </button>
        <button id="modePerpendicular" class="tool icon-btn" title="Prostopadła" aria-label="Prostopadła">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="5" y1="12" x2="19" y2="12"/><line x1="12" y1="5" x2="12" y2="19"/></svg>
          <span class="sr-only">Prostopadła</span>
        </button>
                <button id="modeCircle" class="tool icon-btn" title="Okrąg" aria-label="Okrąg">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="8"/>
            <line x1="12" y1="12" x2="18" y2="12"/>
            <circle cx="18" cy="12" r="1.4" class="icon-fill"/>
          </svg>
          <span class="sr-only">Okrąg</span>
        </button>
        <button id="modeCircleThree" class="tool icon-btn" title="Okrąg przez 3 punkty" aria-label="Okrąg przez 3 punkty">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <ellipse cx="12" cy="12" rx="8.5" ry="7.5" fill="none" stroke="currentColor" stroke-width="1.2"/>
            <circle cx="8" cy="6.5" r="2.2" class="icon-fill" stroke="currentColor" stroke-width="0.8"/>
            <circle cx="16.5" cy="6" r="2.2" class="icon-fill" stroke="currentColor" stroke-width="0.8"/>
            <circle cx="17.5" cy="16" r="2.2" class="icon-fill" stroke="currentColor" stroke-width="0.8"/>
          </svg>
          <span class="sr-only">Okrąg przez 3 punkty</span>
        </button>

        <button id="modeTriangleUp" class="tool icon-btn" title="Trójkąt foremny" aria-label="Trójkąt foremny">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 18h16L12 5Z"/></svg>
          <span class="sr-only">Trójkąt foremny</span>
        </button>
        <button id="modeSquare" class="tool icon-btn" title="Kwadrat" aria-label="Kwadrat">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><rect x="5" y="5" width="14" height="14"/></svg>
          <span class="sr-only">Kwadrat</span>
        </button>
        <button id="modePolygon" class="tool icon-btn" title="Wielokąt" aria-label="Wielokąt">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <polygon points="5,4 19,7 16,19 5,15"/>
            <circle cx="5" cy="4" r="1.2" class="icon-fill"/>
            <circle cx="19" cy="7" r="1.2" class="icon-fill"/>
            <circle cx="16" cy="19" r="1.2" class="icon-fill"/>
            <circle cx="5" cy="15" r="1.2" class="icon-fill"/>
          </svg>
          <span class="sr-only">Wielokąt</span>
        </button>
        <button id="modeNgon" class="tool icon-btn" title="n-gon" aria-label="n-gon">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <polygon points="20,15.5 15.5,20 8.5,20 4,15.5 4,8.5 8.5,4 15.5,4 20,8.5"
              fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
          </svg>
          <span class="sr-only">n-gon</span>
        </button>
        <button id="modeAngle" class="tool icon-btn" title="Kąt" aria-label="Kąt">
          <svg class="icon" viewBox="0 0 64 64" aria-hidden="true">
            <line x1="14" y1="54" x2="50" y2="54" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
            <line x1="14" y1="54" x2="42" y2="18" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
            <path d="M20 46 A12 12 0 0 1 32 54" fill="none" stroke="currentColor" stroke-width="3" />
          </svg>
          <span class="sr-only">Kąt</span>
        </button>
        <button id="modeBisector" class="tool icon-btn" title="Dwusieczna" aria-label="Dwusieczna">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <line x1="6" y1="18" x2="20" y2="18" />
            <line x1="6" y1="18" x2="14" y2="6" />
            <line x1="6" y1="18" x2="20" y2="10" />
          </svg>
          <span class="sr-only">Dwusieczna</span>
        </button>
        <button id="modeMidpoint" class="tool icon-btn" title="Punkt środkowy" aria-label="Punkt środkowy">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="6" cy="12" r="1.5" class="icon-fill"/>
            <circle cx="18" cy="12" r="1.5" class="icon-fill"/>
            <circle cx="12" cy="12" r="2.5" class="icon-fill"/>
            <circle cx="12" cy="12" r="1" fill="var(--bg)" stroke="none"/>
          </svg>
          <span class="sr-only">Punkt środkowy</span>
        </button>
        <button id="modeSymmetric" class="tool icon-btn" title="Punkt symetryczny" aria-label="Punkt symetryczny">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <line x1="12" y1="4" x2="12" y2="20" />
            <circle cx="7.5" cy="10" r="1.7" class="icon-fill"/>
            <circle cx="16.5" cy="14" r="1.7" class="icon-fill"/>
            <path d="M7.5 10 16.5 14" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
          </svg>
          <span class="sr-only">Punkt symetryczny</span>
        </button>
        <button id="modeHandwriting" class="tool icon-btn" title="Pismo odręczne" aria-label="Pismo odręczne">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5.5 18.5 4 20l1.5-.1L9 19l10.5-10.5a1.6 1.6 0 0 0 0-2.2L17.7 4a1.6 1.6 0 0 0-2.2 0L5 14.5l.5 4Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15.5 5.5 18.5 8.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="sr-only">Pismo odręczne</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal" style="display:none;">
    <div class="modal-content settings-modal">
      <div class="modal-header">
        <h2>Konfiguracja</h2>
        <button id="settingsCloseBtn" class="icon-btn" title="Zamknij" aria-label="Zamknij">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal-tabs">
        <button class="tab-btn active" data-tab="general">Ogólne</button>
        <button class="tab-btn" data-tab="buttons">Przyciski</button>
        <button class="tab-btn" data-tab="appearance">Wygląd</button>
      </div>
      <div class="modal-body">
        <div id="tabGeneral" class="tab-content active">
          <div class="config-section">
            <div style="padding: 12px;">
              <h3>Domyślny folder</h3>
              <p class="tab-description">Wybierz folder, w którym będą zapisywane pliki JSON i konfiguracja.</p>
              <div style="display: flex; gap: 12px; margin-top: 16px; align-items: center;">
                <button id="selectDefaultFolderBtn" class="icon-btn" title="Wybierz folder" style="padding: 10px 16px; font-size: 14px;">
                  <svg class="icon" viewBox="0 0 24 24" style="width: 18px; height: 18px; margin-right: 6px;">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Wybierz folder
                </button>
                <span id="defaultFolderPath" style="font-size: 13px; color: var(--fg-secondary); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                  Nie wybrano
                </span>
                <button id="clearDefaultFolderBtn" class="icon-btn" title="Wyczyść" style="padding: 8px; display: none;">
                  <svg class="icon" viewBox="0 0 24 24" style="width: 18px; height: 18px;">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          <div class="config-section" style="margin-top: 16px;">
            <div style="padding: 12px;">
              <h3>Precyzja wymiarów</h3>
              <p class="tab-description">Ustaw liczbę miejsc po przecinku dla wyświetlanych wymiarów.</p>
              <div style="display: flex; gap: 24px; margin-top: 16px;">
                <div style="flex: 1;">
                  <label for="precisionLength" style="display: block; margin-bottom: 8px; font-size: 13px; color: var(--fg-secondary);">
                    Długości (miejsca po przecinku):
                  </label>
                  <input type="number" id="precisionLength" min="0" max="5" value="0" 
                         style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg); color: var(--fg);">
                </div>
                <div style="flex: 1;">
                  <label for="precisionAngle" style="display: block; margin-bottom: 8px; font-size: 13px; color: var(--fg-secondary);">
                    Kąty (miejsca po przecinku):
                  </label>
                  <input type="number" id="precisionAngle" min="0" max="5" value="0"
                         style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg); color: var(--fg);">
                </div>
              </div>
            </div>
          </div>
          <div class="config-section" style="margin-top: 16px;">
            <div style="padding: 12px;">
              <h3>Eksport i Import</h3>
              <p class="tab-description">Zapisz lub wczytaj pełną konfigurację aplikacji (przyciski, kolejność, ustawienia).</p>
              <div style="display: flex; gap: 12px; margin-top: 16px;">
                <button id="exportConfigBtn" class="icon-btn" title="Eksportuj konfigurację" style="padding: 10px 16px; font-size: 14px; flex: 1;">
                  <svg class="icon" viewBox="0 0 24 24" style="width: 18px; height: 18px; margin-right: 6px;">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Eksportuj konfigurację
                </button>
                <button id="importConfigBtn" class="icon-btn" title="Importuj konfigurację" style="padding: 10px 16px; font-size: 14px; flex: 1;">
                  <svg class="icon" viewBox="0 0 24 24" style="width: 18px; height: 18px; margin-right: 6px;">
                    <path d="M12 21V9" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="m7 13 5-5 5 5" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M5 5h14" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Importuj konfigurację
                </button>
                <input type="file" id="importConfigInput" accept=".json" style="display: none;">
              </div>
            </div>
          </div>
        </div>
        <div id="tabButtons" class="tab-content">
          <div class="config-section">
            <div id="multiButtonConfig" class="button-config-area">
              <!-- Dynamic content will be added here -->
            </div>
          </div>
        </div>
        <div id="tabAppearance" class="tab-content">
          <div class="appearance-config">
            <div class="appearance-controls">
              <div class="appearance-theme-toggle">
                <button class="theme-btn active" data-theme="dark">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12a9 9 0 1 1-9-9 6 6 0 0 0 9 9Z"/></svg>
                  Ciemny
                </button>
                <button class="theme-btn" data-theme="light">
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M2 12h2m16 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                  Jasny
                </button>
              </div>
              
              <div class="config-section">
                <h3>Domyślne kolory</h3>
                <div class="config-row">
                  <label>Kolor tła:</label>
                  <div style="display:flex; align-items:center; gap:8px;">
                    <input type="color" id="themeBgColor" class="color-input">
                    <input type="text" id="themeBgColorHex" class="color-hex" placeholder="#rrggbb" maxlength="7">
                  </div>
                </div>
                <div class="config-row">
                  <label>Kolor obrysu:</label>
                  <div style="display:flex; align-items:center; gap:8px;">
                    <input type="color" id="themeStrokeColor" class="color-input">
                    <input type="text" id="themeStrokeColorHex" class="color-hex" placeholder="#rrggbb" maxlength="7">
                  </div>
                </div>
                <div class="config-row">
                  <label>Kolor zaznaczenia:</label>
                  <div style="display:flex; align-items:center; gap:8px;">
                    <input type="color" id="themeHighlightColor" class="color-input">
                    <input type="text" id="themeHighlightColorHex" class="color-hex" placeholder="#rrggbb" maxlength="7">
                  </div>
                </div>
                <div class="config-row">
                  <label>Kolor okna (panel):</label>
                  <div style="display:flex; align-items:center; gap:8px;">
                    <input type="color" id="themePanelColor" class="color-input">
                    <input type="text" id="themePanelColorHex" class="color-hex" placeholder="#rrggbb" maxlength="7">
                  </div>
                </div>
              </div>
 
              <div class="appearance-preview">
                <h3>Podgląd</h3>
                <div class="preview-canvas-wrapper">
                  <canvas id="previewCanvas" width="400" height="400"></canvas>
                </div>
              </div>

              <div class="config-section">
                <h3>Domyślne rozmiary</h3>
                <div class="config-row">
                  <label>Grubość linii:</label>
                  <div class="size-control">
                    <button class="size-btn" data-action="decrease" data-target="lineWidth">−</button>
                    <span class="size-value" id="themeLineWidthValue">2 px</span>
                    <button class="size-btn" data-action="increase" data-target="lineWidth">+</button>
                  </div>
                </div>
                <div class="config-row">
                  <label>Rozmiar punktu:</label>
                  <div class="size-control">
                    <button class="size-btn" data-action="decrease" data-target="pointSize">−</button>
                    <span class="size-value" id="themePointSizeValue">8 px</span>
                    <button class="size-btn" data-action="increase" data-target="pointSize">+</button>
                  </div>
                </div>
                <div class="config-row">
                  <label>Promień łuku kąta:</label>
                  <div class="size-control">
                    <button class="size-btn" data-action="decrease" data-target="arcRadius">−</button>
                    <span class="size-value" id="themeArcRadiusValue">24 px</span>
                    <button class="size-btn" data-action="increase" data-target="arcRadius">+</button>
                  </div>
                </div>
                <div class="config-row">
                  <label>Rozmiar czcionki:</label>
                  <div class="size-control">
                    <button class="size-btn" data-action="decrease" data-target="fontSize">−</button>
                    <span class="size-value" id="themeFontSizeValue">16 px</span>
                    <button class="size-btn" data-action="increase" data-target="fontSize">+</button>
                  </div>
                </div>
                <div class="config-row">
                  <label>Szerokość zaznaczenia:</label>
                  <div class="size-control">
                    <button class="size-btn" data-action="decrease" data-target="highlightWidth">−</button>
                    <span class="size-value" id="themeHighlightWidthValue">3 px</span>
                    <button class="size-btn" data-action="increase" data-target="highlightWidth">+</button>
                  </div>
                </div>
              </div>

              <div class="config-section">
                <button id="resetThemeDefaults" class="icon-btn" style="width: 100%; padding: 12px;">
                  Przywróć domyślne
                </button>
              </div>
            </div>
            
            <!-- preview moved earlier (after colors, before sizes) -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- N-gon Modal -->
  <div id="ngonModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width: 320px;">
      <div class="modal-header">
        <h2>Liczba boków</h2>
        <button id="ngonCloseBtn" class="icon-btn" title="Zamknij" aria-label="Zamknij">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 16px;">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 16px;">
          <button class="ngon-preset-btn tool icon-btn" data-n="5" style="width: 100%; justify-content: center;">5</button>
          <button class="ngon-preset-btn tool icon-btn" data-n="6" style="width: 100%; justify-content: center;">6</button>
          <button class="ngon-preset-btn tool icon-btn" data-n="7" style="width: 100%; justify-content: center;">7</button>
          <button class="ngon-preset-btn tool icon-btn" data-n="8" style="width: 100%; justify-content: center;">8</button>
          <button class="ngon-preset-btn tool icon-btn" data-n="12" style="width: 100%; justify-content: center;">12</button>
          <button class="ngon-preset-btn tool icon-btn" data-n="18" style="width: 100%; justify-content: center;">18</button>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
          <label for="ngonInput" style="white-space: nowrap;">n =</label>
          <input type="number" id="ngonInput" min="3" max="100" value="9" style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-input); color: var(--fg-primary);">
          <button id="ngonConfirmBtn" class="icon-btn" style="padding: 8px 16px; background: var(--accent-color); color: white;">OK</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./dist/main.js"></script>
  <div id="swUpdateToast" class="sw-toast" aria-live="polite" style="display:none; position:fixed; left:50%; transform:translateX(-50%); bottom:20px; z-index:100; width:min(420px, 92vw);">
    <div class="sw-toast__inner">
      <span id="swUpdateText" class="sw-toast__message">Nowa wersja dostępna</span>
      <div class="sw-toast__actions">
        <button id="swUpdateBtn" class="sw-toast__button">Zastosuj</button>
        <button id="swDismissBtn" class="sw-toast__button sw-toast__button--ghost">Później</button>
      </div>
    </div>
  </div>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js', { updateViaCache: 'none', scope: '/' }).then(reg => {
        reg.update().catch(() => {});

        function showUpdateToast(worker) {
          const toast = document.getElementById('swUpdateToast');
          const apply = document.getElementById('swUpdateBtn');
          const dismiss = document.getElementById('swDismissBtn');
          toast.style.display = 'block';
          apply.onclick = () => {
            worker.postMessage({ type: 'SKIP_WAITING' });
            toast.style.display = 'none';
          };
          dismiss.onclick = () => { toast.style.display = 'none'; };
        }

        if (reg.waiting) {
          showUpdateToast(reg.waiting);
        }

        reg.addEventListener('updatefound', () => {
          const newWorker = reg.installing;
          if (!newWorker) return;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              showUpdateToast(newWorker);
            }
          });
        });
      }).catch(err => {
        console.warn('SW registration failed:', err);
      });
    }
  </script>
</body>
</html>
